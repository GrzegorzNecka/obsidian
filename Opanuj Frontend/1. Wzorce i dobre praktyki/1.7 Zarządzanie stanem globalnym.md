Zanim zapoznamy siÄ™ z Redux Toolkit, ktÃ³re powstaÅ‚o na bazie lekcji wyciÄ…gniÄ™tych z Reduxa, sprÃ³bujmy odpowiedzieÄ‡ na waÅ¼ne pytanie:

### Czy mÃ³j projekt potrzebuje biblioteki do zarzÄ…dzania stanem globalnym?

W React bezpieczna odpowiedÅº brzmi:Â **to zaleÅ¼y.**Â Od tego czy Twoja aplikacja faktycznie potrzebuje stanu globalnego, jeÅ¼eli tak to: jak czÄ™sto siÄ™ on zmienia i co jest w niej renderowane.Â 

Jak wspominaliÅ›my w lekcjiÂ , ==Context API pozwala nam udostÄ™pniaÄ‡ stan globalnie, ale musimy liczyÄ‡ siÄ™ z mechanizmem re-renderowania konsumentÃ³w==, stÄ…d z peÅ‚nym spokojem ==nadaje siÄ™ do obsÅ‚ugi stanu globalnego o charakterze statycznym/rzadko ulegajÄ…cym zmianom==:

- **Ustawienia globalne**Â aplikacji, takie jak motyw, preferencje jÄ™zykowe czy preferencje dostÄ™pnoÅ›ci.
- **Dane uwierzytelniajÄ…ce uÅ¼ytkownika**, takie jak status zalogowania i uprawnienia, ktÃ³re sÄ… potrzebne w rÃ³Å¼nych czÄ™Å›ciach aplikacji do zarzÄ…dzania sesjÄ… i uprawnieniami dostÄ™powymi uÅ¼ytkownika.
- **UI state**, ktÃ³ry musi byÄ‡ dostÄ™pny globalnie, ale zmienia siÄ™ rzadko, na przykÅ‚ad status poÅ‚Ä…czenia internetowego, tryb ciemny/jasny.
  
Jednak ==jeÅ¼eli pracujemy nad maÅ‚Ä… lub Å›redniÄ… aplikacjÄ…== lub nie potrzebujemy udostÄ™pniaÄ‡ danych globalnie, tylko w ramach jednej rozbudowanej funkcji (np. **wieloetapowy formularz**), to Å›miaÅ‚o moÅ¼emy zdecydowaÄ‡ siÄ™ na ==dedykowany kontekst poÅ‚Ä…czony z hookami do zarzÄ…dzania stanem (useState, useReducer)==. Nie przez przypadek zespÃ³Å‚ Reacta rekomenduje takie rozwiÄ…zanie w ramachÂ [Context API Use Cases](https://react.dev/learn/passing-data-deeply-with-context#use-cases-for-context)Â orazÂ [Scaling Up with Reducer and Context](https://react.dev/learn/scaling-up-with-reducer-and-context)Â - zauwaÅ¼, Å¼e nie ma tam Å¼adnych ostrzeÅ¼eÅ„ dotyczÄ…cych zagadnienia rerenderowania. Na dodatek nadchodzÄ…ca wersja React 19, moÅ¼e przynieÅ›Ä‡ znaczne usprawnienia w zakresie wydajnoÅ›ci, o czym wiÄ™cejÂ [przeczytasz na oficjalnym blogu Reacta](https://react.dev/blog/2024/02/15/react-labs-what-we-have-been-working-on-february-2024).

PamiÄ™tajmy, Å¼e wciÄ…ganie do projektu biblioteki do zarzÄ…dzania stanem wnosi nastÄ™pujÄ…ce **trade-offy i ryzyka:**

- Trade-off: ÅšcisÅ‚e powiÄ…zanie z kluczowÄ… zaleÅ¼noÅ›ciÄ…, ktÃ³rejÂ **ciÄ™Å¼ko**Â pozbyÄ‡ siÄ™ w przyszÅ‚oÅ›ci
- Trade-off: WyÅ¼szy prÃ³g wejÅ›cia do projektu (zaleÅ¼ne od biblioteki i kompetencji ludzi na rynku pracy)
- Trade-off: WyÅ¼sza zÅ‚oÅ¼onoÅ›Ä‡ projektu (zaleÅ¼ne od biblioteki i zespoÅ‚u)
- Ryzyko: WydÅ‚uÅ¼ony czas realizacji projektu i koszta jego utrzymania (czy i jak bardzo, zaleÅ¼y od zespoÅ‚u, projektu i biblioteki)
    

Jako Å›wiadomi developerzy nie dajmy siÄ™ zastraszyÄ‡ komentarzom o tym, Å¼e Context API pogrÄ…Å¼y wydajnoÅ›Ä‡ dowolnej aplikacji - w wiÄ™kszoÅ›ci wypadkÃ³w to jedynie Å‚aÅ„cuszek powtarzany bez zrozumienia, tak samo jak powtarzano, Å¼e kaÅ¼da duÅ¼a/zÅ‚oÅ¼ona aplikacja powinna korzystaÄ‡ z Reduxa. PamiÄ™tajmy, Å¼e programowanie to sztuka trade-offÃ³w. CzÄ™sto warto wybraÄ‡ prostotÄ™ i brak dodatkowych zaleÅ¼noÅ›ci kosztem suboptymalnego re-renderowania komponentÃ³w. Dlaczego? W wielu widokach rÃ³Å¼nica pomiÄ™dzy optymalnym a subotymalnym rerenderowaniem nie bÄ™dzie zauwaÅ¼alna dla uÅ¼ytkownika, czyliÂ **nie bÄ™dzie miaÅ‚a znaczenia**. React, podobnie jak konkurencja, naprawdÄ™ nieÅºle radzi sobie z aktualizowaniem DOM - to w koÅ„cu jego gÅ‚Ã³wne zadanie. ZresztÄ… zobacz sam:

==Kiedy biblioteka do zarzÄ…dania stanem to dobry pomysÅ‚== bez wiÄ™kszych wÄ…tpliwoÅ›ci:

- stan globalny ulega bardzo czÄ™stym i/lub zÅ‚oÅ¼onym zmianom
- core naszego interfejsu jest kosztowny w renderowaniu, np. skÅ‚ada siÄ™ z wykresÃ³w, setek/tysiÄ™cy elementÃ³w lub zawiera liczne animacje
- mamy wyÅ›rubowane wymagania co do przewidywalnoÅ›ci i testowania stanu, tj. pracujemy w domenie finansÃ³w, bezpieczeÅ„stwa, zdrowia.

ZauwaÅ¼, Å¼e â€œprojekt jest duÅ¼yâ€ nie znalazÅ‚ siÄ™ na tej liÅ›cie, i nie jest to przypadek.Â   
  
OczywiÅ›cie decyzja o tym czy skorzystaÄ‡ z biblioteki do zarzÄ…dzania stanem powinna byÄ‡ wypadkowÄ… nie tylko analizy wymagaÅ„, ale rÃ³wnieÅ¼ preferencji zespoÅ‚u/firmy. Wiele teamÃ³w, ktÃ³re podobnie jak ja â€œnabraÅ‚y siÄ™ na Reduxaâ€, przyzwyczaiÅ‚o siÄ™ do korzystania bibliotek, ba, po prostu lubi z nimi pracowaÄ‡, i to jest jak najbardziej okej. WnoszÄ… one porzÄ…dek i ukierunkowujÄ… na pisanie kodu zgodnie z okreÅ›lonymi patternami. CaÅ‚y ten wywÃ³d to apel, Å¼ebyÅ›my byli Å›wiadomi, Å¼e podejmujemy decyzje kierujÄ…c siÄ™ preferencjami (prawdziwy powÃ³d) zamiast szukaÄ‡ dobrych powodÃ³w - to moÅ¼e niepotrzebnie zaburzaÄ‡ nasz osÄ…d i dyscyplinÄ™ intelektualnÄ… w przypadku przyszÅ‚ych decyzji dotyczÄ…cych architektury i stacku technologicznego projektu.

---

W przypadku Angulara i Vue sytuacja jest mniej skomplikowana. Frameworki te majÄ… wbudowane API, ktÃ³re pozwalajÄ… nam komfortowo zarzÄ…dzaÄ‡ stanem globalnym bez obaw o wydajnoÅ›Ä‡ jak w przypadku Reacta (Angular: serwisy, Vue: Composition API). DziÄ™ki temu moÅ¼emy zrealizowaÄ‡ naprawdÄ™ wiele projektÃ³w i funkcji bez korzystania z zewnÄ™trznej biblioteki.

OsobiÅ›cie proponujemy trzymaÄ‡ siÄ™ wbudowanych API zwÅ‚aszcza w przypadku Angulara, poniewaÅ¼ NgRx cierpi na wiÄ™kszoÅ›Ä‡ tych samych problemÃ³w co Redux (i na dodatek ma jeszcze wyÅ¼szy prÃ³g wejÅ›cia) - poÅ‚Ä…czenie serwisÃ³w i RxJS jest naprawdÄ™ potÄ™Å¼ne, warto korzystaÄ‡ z tego duetu.

W przypadku Vue moÅ¼emy zdecydowaÄ‡ siÄ™ na bibliotekÄ™Â [Pinia](https://pinia.vuejs.org/), ktÃ³rÄ… ze wzglÄ™du na swojÄ… prostotÄ™ i silnÄ… integracjÄ™ z Composition API moÅ¼na poznaÄ‡ w jeden wieczÃ³r. JedynÄ… istotnÄ… cenÄ… jest tutaj Å›cisÅ‚e powiÄ…zanie z tÄ… zaleÅ¼noÅ›ciÄ…, resztÄ™ trade-offÃ³w moÅ¼emy tutaj pominÄ…Ä‡ ze wzglÄ™du na niesamowitÄ… intuicyjnoÅ›Ä‡ i oficjalne wsparcie core teamâ€™u VueJS.  
  
WracajÄ…c do Å›wiata Reacta. PrÄ™dzej czy pÃ³Åºniej bÄ™dziemy musieli zmierzyÄ‡ siÄ™ z Reduxem i architekturÄ… Flux, czy to ze wzglÄ™du na wymagania projektu, czy teÅ¼ preferencje zespoÅ‚Ã³w co znajduje odzwierciedlenie w wielu ofertach pracy, stÄ…d zapraszam na spotkanie z RTK.Â 

## Wprowadzenie do Redux-Toolkit

Jak juÅ¼ wspominaliÅ›my, â€œczystyâ€ Redux ma swoje problemy. Jego szczegÃ³Å‚owoÅ›Ä‡ sprawia, Å¼e trudno siÄ™ go nauczyÄ‡, a dodatkowy kod potrzebny do codziennej pracy w wielu projektach wprowadza nadmiarowÄ… zÅ‚oÅ¼onoÅ›Ä‡ i ociÄ™Å¼aÅ‚oÅ›Ä‡.

SpoÅ›rÃ³d dostÄ™pnych opcji w zakresie bibliotek do zarzÄ…dzania stanem, obecnie najpopularniejszym graczem jestÂ [Redux Toolkit](https://redux-toolkit.js.org/)Â (RTK), ktÃ³ry cechuje uproszczone i opiniotwÃ³rcze podejÅ›cie do pracy z Reduxem.Â 

Redux Toolkit zapewnia kilka narzÄ™dzi i abstrakcji w celu usprawnienia naszej pracy:

- [createSlice](https://redux-toolkit.js.org/api/createSlice): Ta funkcja â€œmagicznieâ€ Å‚Ä…czy akcje i reducery w jeden fragment stanu (slice). Automatycznie generuje action creatory i reducery, pozwala pisaÄ‡ â€œmutowalneâ€ aktualizacje stanu - to wszystko znacznie zmniejsza iloÅ›Ä‡ boilerplateâ€™u.Â 

- [configureStore](https://redux-toolkit.js.org/api/configureStore): Ta funkcja konfiguruje store Redux z rozsÄ…dnymi wartoÅ›ciami domyÅ›lnymi. Zawiera wbudowane middlewareâ€™y, takie jakÂ [Redux Thunk](https://redux.js.org/usage/writing-logic-thunks)Â do obsÅ‚ugi logiki asynchronicznej, i automatycznie konfiguruje rozszerzenieÂ [Redux DevTools](https://chrome.google.com/webstore/detail/redux-devtools/lmhkpmbekcpmknklioeibfkpmmfibljd)Â do debugowania.
    
- [createAsyncThunk](https://redux-toolkit.js.org/api/createAsyncThunk): To narzÄ™dzie upraszcza obsÅ‚ugÄ™ operacji asynchronicznych w Redux, takich jak wywoÅ‚ania API. Generuje asynchroniczne action creatory, ktÃ³re wysyÅ‚ajÄ… kilka akcji, aby odzwierciedliÄ‡ rÃ³Å¼ne etapy operacji asynchronicznej (np. Å‚adowanie, sukces, niepowodzenie).
    

WykorzystujÄ…c Redux Toolkit, moÅ¼emy pisaÄ‡ kod Redux w bardziej zwiÄ™zÅ‚y i intuicyjny sposÃ³b, zmniejszajÄ…c ogÃ³lnÄ… zÅ‚oÅ¼onoÅ›Ä‡ i boilerplate znane z klasycznego Reduxa. ZresztÄ… zobacz sam:

Redux Toolkit to bardziej przyjazna i zwiÄ™zÅ‚a biblioteka wzglÄ™dem pierwowzoru, ale nadal ma istotny wpÅ‚yw na podniesienie zÅ‚oÅ¼onoÅ›ci naszego projektu. Åatwo o tym zapomnieÄ‡, kiedy juÅ¼ dobrze jÄ… poznamy, ale wystarczy spojrzeÄ‡ na objÄ™toÅ›Ä‡Â [dokumentacji](https://redux-toolkit.js.org/)Â - jest ona podobna do samego Reacta. W poÅ‚Ä…czeniu z licznymi odnoÅ›nikami doÂ [dokumentacji â€œczystegoâ€ Reduxa](https://redux.js.org/), jest tutaj wiÄ™cej do opanowania niÅ¼ w samym Reactcie.Â 

W 2024 warto zainwestowaÄ‡ czas w naukÄ™ RTK, poniewaÅ¼ jest to najczÄ™Å›ciej wykorzystywana biblioteka do zarzÄ…dzania stanem i spotkasz jÄ… w wielu projektach legacy, co potwierdzajÄ… statystykiÂ [npm trends](https://npmtrends.com/@reduxjs/toolkit-vs-jotai-vs-mobx-vs-recoil-vs-valtio-vs-xstate-vs-zustand).Â 

Co istotne, RTK ma rosnÄ…cÄ… i co raz silniejszÄ… konkurencjÄ™ ze stronyÂ [Zustand](https://github.com/pmndrs/zustand), biblioteki ktÃ³rÄ… wyrÃ³Å¼nia prostota i intuicyjnoÅ›Ä‡ - jeÅ¼eli ten trend siÄ™ utrzyma a Zustand przegoni RTK i â€œzostanie z nami na staÅ‚eâ€, to w 2025 moÅ¼ecie siÄ™ spodziwaÄ‡ aktualizacji rekomendowanej biblioteki oraz samej sekcji â€œ**Czy mÃ³j projekt potrzebuje biblioteki do zarzÄ…dzania stanem globalnym?â€**.

---

## PrzeglÄ…d pozostaÅ‚ych bibliotek do zarzÄ…dzania stanemÂ 

### **React**

1. [**Zustand**](https://github.com/pmndrs/zustand)Â to minimalistyczna biblioteka do zarzÄ…dzania stanem, ktÃ³ra charakteryzuje siÄ™ prostotÄ… i Å‚atwoÅ›ciÄ… w uÅ¼yciu. Nie wymaga uÅ¼ycia reducerÃ³w ani akcji (w przeciwieÅ„stwie do Reduxa), co czyni jÄ… bardziej dostÄ™pnÄ… dla poczÄ…tkujÄ…cych. Zustand wykorzystuje hooki do korzystania ze stanu globalnego, ktÃ³re mogÄ… byÄ‡ Å‚atwo wykorzystywane przez komponenty.
    
2. [**Jotai**](https://jotai.org/)Â **-**Â bibliotekÄ… do zarzÄ…dzania stanem w React, ktÃ³ra oferuje prosty i efektywny sposÃ³b na zarzÄ…dzanie stanem z podejÅ›ciem atom-based. Pozwala na tworzenie mniejszych, niezaleÅ¼nych jednostek stanu, tzw. atomÃ³w, ktÃ³re mogÄ… byÄ‡ wykorzystywane i aktualizowane niezaleÅ¼nie w sposÃ³b przypominajÄ…cy sygnaÅ‚y. Istotna wada: stosunkowo niszowe rozwiÄ…zanie.
    

### Angular

1. [NgRx](https://ngrx.io/)Â - NgRx to kompleksowe rozwiÄ…zanie do zarzÄ…dzania stanem dla Angulara, inspirowane przez Redux. Oferuje bogaty zestaw narzÄ™dzi do zarzÄ…dzania stanem aplikacji, efektami ubocznymi, izolacjÄ… zaleÅ¼noÅ›ci. Redux + RxJS = sounds like â€œfunâ€.
    
2. [NgXs](https://www.npmjs.com/package/@ngxs/store)Â jest alternatywÄ… dla NgRx, oferujÄ…cÄ… prostsze i bardziej deklaratywne podejÅ›cie do zarzÄ…dzania stanem w Angularze. UmoÅ¼liwia Å‚atwe zarzÄ…dzanie stanem poprzez proste dekoratory i mniejszÄ… iloÅ›Ä‡ kodu boilerplate. Istotna wada: stosunkowo niszowe rozwiÄ…zanie.
    

### Vue

1. [Pinia](https://pinia.vuejs.org/)Â - â€œaktualnaâ€ oficjalna biblioteka do zarzÄ…dzania stanem dla Vue.js Jest nowoczesnÄ…, lÅ¼ejszÄ… alternatywÄ… dla Vuex, oferujÄ…cÄ… prostsze i bardziej elastyczne podejÅ›cie do zarzÄ…dzania stanem w aplikacjach Vue. Charakteryzuje siÄ™ Å‚atwÄ… konfiguracjÄ… i maÅ‚Ä… iloÅ›ciÄ… boilerplate.
    
2. [Vuex](https://www.npmjs.com/package/vuex)Â - â€œemerytowanaâ€ oficjalna biblioteka do zarzÄ…dzania stanem dla Vue.js, zapewniajÄ…cÄ… scentralizowane przechowywanie dla wszystkich komponentÃ³w aplikacji. Wzoruje siÄ™ na architekturze Flux/Redux, ale jest dostosowane do reaktywnoÅ›ci Vue.
    

## **Najlepsze praktyki**

Context API, ktÃ³re pojawia siÄ™ w powyÅ¼szych fragmentach jako lekarstwo na zarzÄ…dzanie stanem globalnym, moÅ¼e czasami prowadziÄ‡ do nadmiernego odÅ›wieÅ¼ania i renderowania komponentÃ³w. JeÅ›li chcemy sprawiÄ‡, aby niektÃ³re z komponentÃ³w byÅ‚y bardziej stabilne i nie ulegaÅ‚y odÅ›wieÅ¼eniu przy kaÅ¼dej zmianie kontekstu, na ktÃ³rym polegajÄ…, moÅ¼emy zdecydowaÄ‡ siÄ™ na trzy propozycje od twÃ³rcy Reacta.

## Jak radziÄ‡ sobie z re-renderami w Context API?

To istotna wiedza, wiÄ™c pozwoliÅ‚em sobie przekleiÄ‡Â [przetÅ‚umaczone rekomendacje Dana Abramova](https://github.com/facebook/react/issues/15156?fbclid=IwAR0mjKkp-m4p4gNrzOuz8zUf37vWeTuagCaF7CQrCMKZu7y45_cmoEYzTaI#issuecomment-474590693).

Kontekst przykÅ‚adÃ³w z poszczegÃ³lnych opcji: ZaÅ‚Ã³Å¼my, Å¼e pracujesz nad komponentem kontenerowym, ktÃ³ry obsÅ‚uguje rozbudowany formularz wieloetapowy i musi siÄ™ dostosowaÄ‡ do motywu aplikacji, ktÃ³ry uÅ¼ytkownik moÅ¼e zmieniÄ‡ w widoku ustawieÅ„.

### Opcja 1 (preferowana): Rozdziel konteksty, ktÃ³re nie zmieniajÄ… siÄ™ razem

JeÅ›li w wielu komponentach potrzebujemy tylko maÅ‚ej czÄ™Å›ci kontekstu, np.Â _appContextValue.theme_, ale reszta kontekstu zmienia siÄ™ zbyt czÄ™sto, moÅ¼emy oddzieliÄ‡ ThemeContext od AppContext.

```tsx
function Button() {
  let theme = useContext(ThemeContext);
  // The rest of your rendering logic
  return <ExpensiveTree className={theme} />;
}
```

Teraz zmianaÂ _AppContext_Â nie spowoduje ponownego renderowania konsumentÃ³wÂ _ThemeContext_.

Jest to preferowana poprawka. Wtedy nie potrzebujesz Å¼adnego specjalnego ratunku.

## Opcja 2: Podziel swÃ³j komponent na dwie czÄ™Å›ci, umieÅ›Ä‡Â _memo()_Â pomiÄ™dzy nimi

JeÅ›li z jakiegoÅ› powodu nie moÅ¼esz rozdzieliÄ‡ kontekstÃ³w, nadal moÅ¼esz zoptymalizowaÄ‡ renderowanie, dzielÄ…c komponent na dwie czÄ™Å›ci i przekazujÄ…c bardziej szczegÃ³Å‚owe propsy do komponentu zagnieÅ¼dÅ¼onego, ktÃ³ry otoczyszÂ [React.memo()](https://react.dev/reference/react/memo). Nadal bÄ™dziesz renderowaÄ‡ komponent zewnÄ™trzny, ale nie powinno to mieÄ‡ negatywnego wpÅ‚ywu na wydajnoÅ›Ä‡ (ten komponent nic nie robi).

```javascript
function Button() {
  let appContextValue = useContext(AppContext);
  let theme = appContextValue.theme; 
  return <ThemedButton theme={theme} />
}

const ThemedButton = memo(({ theme }) => {
  return <ExpensiveTree className={theme} />;
});
```

## Opcja 3: Jeden komponent z useMemo wewnÄ…trz

Wreszcie, moglibyÅ›my uczyniÄ‡ nasz kod nieco bardziej rozwlekÅ‚ym, ale zachowaÄ‡ go w pojedynczym komponencie, wrappujÄ…c wartoÅ›Ä‡ zwracanÄ… wÂ [useMemo](https://react.dev/reference/react/useMemo)Â i okreÅ›lajÄ…c konsumowanÄ… wartoÅ›Ä‡ kontekstu jako zaleÅ¼noÅ›ci. Nasz komponent zewnÄ™trzny nadal bÄ™dzie renderowaÅ‚ siÄ™ ponownie, ale React nie bÄ™dzie renderowaÅ‚ ponownie drzewa potomnego, jeÅ›li dane wejÅ›ciowe useMemo pozostanÄ… takie same.

```javascript
function Button() {
  let appContextValue = useContext(AppContext);
  let theme = appContextValue.theme; 

  return useMemo(() => {
    return <ExpensiveTree className={theme} />;
  }, [theme])
}
```

## **ğŸ“š MateriaÅ‚y dodatkowe**

- [Getting Started with React DevTools in Chrome](https://www.debugbear.com/blog/react-devtools#visualizing-the-cause-of-a-components-render)
    
- [How to use Redux DevTools](https://www.youtube.com/watch?v=BYpuigD01Ew)
    
- [You Might Not Need Redux](https://medium.com/@dan_abramov/you-might-not-need-redux-be46360cf367)
    
- [Immutability in React and Redux: The Complete Guide](https://daveceddia.com/react-redux-immutability-guide/)